<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#3B82F6">
    <title>Registro de Lectura</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
   <link rel="apple-touch-icon" href="apple-touch-icon.png">
   <link rel="icon" type="image/png" sizes="192x192" href="android-chrome-192x192.png">
   <link rel="icon" type="image/png" sizes="512x512" href="android-chrome-512x512.png">
   <link rel="manifest" href="manifest.json">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: #f3f4f6; }
        .container { max-width: 48rem; margin: 0 auto; padding: 1rem; padding-bottom: 5rem; }
        header { margin-bottom: 1.5rem; }
        h1 { font-size: 1.875rem; font-weight: bold; color: #1f2937; }
        .subtitle { color: #6b7280; }
        
        .card { background: white; border-radius: 0.5rem; padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .card h2 { font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; }
        .card h3 { font-size: 1rem; font-weight: 600; margin-bottom: 0.75rem; }
        
        .gradient-card { background: linear-gradient(135deg, #3b82f6 0%, #9333ea 100%); color: white; }
        .gradient-card .big-number { font-size: 3rem; font-weight: bold; margin: 0.5rem 0; }
        .gradient-card .next-milestone { opacity: 0.9; font-size: 0.875rem; }
        
        .btn { padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; font-size: 1rem; font-weight: 600; cursor: pointer; width: 100%; transition: all 0.2s; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        .btn-secondary { background: #d1d5db; color: #1f2937; }
        .btn-secondary:hover { background: #9ca3af; }
        .btn:disabled { background: #d1d5db; cursor: not-allowed; }
        
        .book-item { padding: 0.75rem; border: 2px solid #e5e7eb; border-radius: 0.5rem; margin-bottom: 0.75rem; cursor: pointer; transition: all 0.2s; }
        .book-item:hover { border-color: #9ca3af; }
        .book-item.selected { border-color: #3b82f6; background: #eff6ff; }
        .book-title { font-weight: 600; margin-bottom: 0.25rem; }
        .book-date { font-size: 0.875rem; color: #6b7280; }
        
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 50; align-items: center; justify-content: center; padding: 1rem; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 0.5rem; padding: 1.5rem; max-width: 28rem; width: 100%; }
        .modal h3 { font-size: 1.125rem; font-weight: 600; margin-bottom: 1rem; }
        
        input[type="text"], input[type="number"], textarea { width: 100%; padding: 0.5rem 0.75rem; border: 1px solid #d1d5db; border-radius: 0.375rem; font-size: 1rem; }
        textarea { min-height: 8rem; resize: vertical; }
        
        .session-timer { background: white; border-radius: 0.5rem; padding: 1rem; margin-bottom: 1rem; text-align: center; }
        .timer-label { font-size: 0.875rem; color: #6b7280; margin-bottom: 0.5rem; }
        .timer-value { font-size: 2.5rem; font-weight: bold; color: #3b82f6; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .stat-card { background: white; border-radius: 0.5rem; padding: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .stat-label { font-size: 0.875rem; color: #6b7280; margin-bottom: 0.25rem; }
        .stat-value { font-size: 1.5rem; font-weight: bold; color: #3b82f6; }
        
        .chart-container { margin-top: 1rem; }
        .chart { display: flex; align-items: flex-end; height: 10rem; border-left: 1px solid #d1d5db; border-bottom: 1px solid #d1d5db; padding: 0.5rem 0; }
        .bar { flex: 1; background: #3b82f6; border-radius: 0.25rem 0.25rem 0 0; margin: 0 1px; min-width: 0.5rem; transition: all 0.2s; cursor: pointer; }
        .bar:hover { background: #2563eb; }
        .day-label { text-align: center; font-size: 0.625rem; color: #6b7280; margin-top: 0.25rem; }
        
        .month-bar { display: flex; align-items: center; margin-bottom: 0.5rem; }
        .month-label { width: 3rem; font-size: 0.875rem; font-weight: 600; }
        .month-bar-bg { flex: 1; background: #e5e7eb; border-radius: 0.375rem; height: 1.5rem; position: relative; }
        .month-bar-fill { background: #9333ea; height: 100%; border-radius: 0.375rem; display: flex; align-items: center; justify-content: flex-end; padding: 0 0.5rem; transition: all 0.3s; }
        .month-bar-text { color: white; font-size: 0.75rem; font-weight: 600; white-space: nowrap; }
        
        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; border-top: 1px solid #e5e7eb; box-shadow: 0 -1px 3px rgba(0,0,0,0.1); }
        .nav-container { max-width: 48rem; margin: 0 auto; display: flex; justify-content: space-around; padding: 0.75rem; }
        .nav-btn { background: none; border: none; display: flex; flex-direction: column; align-items: center; gap: 0.25rem; color: #6b7280; cursor: pointer; padding: 0.5rem; }
        .nav-btn.active { color: #3b82f6; }
        .nav-icon { width: 1.5rem; height: 1.5rem; }
        .nav-label { font-size: 0.75rem; }
        
        .alert { background: #d1fae5; border-left: 4px solid #10b981; padding: 1rem; border-radius: 0.375rem; margin-bottom: 1.5rem; animation: slideIn 0.3s; }
        .alert-text { color: #065f46; font-weight: 600; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(-1rem); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .pulse { animation: pulse 2s infinite; }
        
        .hidden { display: none; }
        .mb-1 { margin-bottom: 0.25rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .flex { display: flex; }
        .gap-2 { gap: 0.5rem; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .text-gray { color: #6b7280; }
        .font-semibold { font-weight: 600; }
        
        .session-options { display: flex; flex-direction: column; gap: 0.75rem; }
        .option-btn { border: 2px solid #3b82f6; background: white; padding: 1rem; border-radius: 0.5rem; text-align: left; cursor: pointer; transition: all 0.2s; }
        .option-btn:hover { background: #eff6ff; }
        .option-title { font-weight: 600; margin-bottom: 0.25rem; }
        .option-desc { font-size: 0.875rem; color: #6b7280; }
        
        .timer-input-group { display: flex; align-items: center; gap: 0.5rem; margin-top: 0.75rem; }
        .timer-input { width: 5rem; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Registro de Lectura</h1>
            <p class="subtitle">Construye tu hábito día a día</p>
        </header>
        
        <div id="app"></div>
    </div>
    
    <nav class="nav">
        <div class="nav-container">
            <button class="nav-btn active" onclick="app.setView('home')">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                <span class="nav-label">Inicio</span>
            </button>
            <button class="nav-btn" onclick="app.setView('stats')">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"/></svg>
                <span class="nav-label">Estadísticas</span>
            </button>
            <button class="nav-btn" onclick="app.setView('books')">
                <svg class="nav-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/></svg>
                <span class="nav-label">Libros</span>
            </button>
        </div>
    </nav>
    
    <script>const app = {
            view: 'home',
            books: [],
            sessions: [],
            currentSession: null,
            sessionType: null,
            timerMinutes: 10,
            elapsedSeconds: 0,
            selectedBook: null,
            intervalId: null,
            alarmPlayed: false,
            
            init() {
                this.loadData();
                this.render();
                setInterval(() => {
                    if (this.currentSession) {
                        this.updateTimer();
                    }
                }, 1000);
            },
            
            loadData() {
                const savedBooks = localStorage.getItem('readingBooks');
                const savedSessions = localStorage.getItem('readingSessions');
                if (savedBooks) this.books = JSON.parse(savedBooks);
                if (savedSessions) this.sessions = JSON.parse(savedSessions);
            },
            
            saveData() {
                localStorage.setItem('readingBooks', JSON.stringify(this.books));
                localStorage.setItem('readingSessions', JSON.stringify(this.sessions));
            },
            
            setView(view) {
                this.view = view;
                document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
                event.target.closest('.nav-btn').classList.add('active');
                this.render();
            },
            
            render() {
                const appEl = document.getElementById('app');
                if (this.view === 'home') appEl.innerHTML = this.renderHome();
                else if (this.view === 'stats') appEl.innerHTML = this.renderStats();
                else if (this.view === 'books') appEl.innerHTML = this.renderBooks();
            },
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
            },
            
            getConsecutiveDays() {
                if (this.sessions.length === 0) return 0;
                const uniqueDays = [...new Set(this.sessions.map(s => s.date))].sort().reverse();
                let consecutive = 0;
                const today = new Date().toISOString().split('T')[0];
                let checkDate = new Date(today);
                
                for (let day of uniqueDays) {
                    const dayStr = checkDate.toISOString().split('T')[0];
                    if (day === dayStr) {
                        consecutive++;
                        checkDate.setDate(checkDate.getDate() - 1);
                    } else break;
                }
                return consecutive;
            },
            
            getTotalMinutes(date = null) {
                return this.sessions
                    .filter(s => !date || s.date === date)
                    .reduce((sum, s) => sum + s.minutes, 0);
            },
            
            updateTimer() {
                const now = new Date();
                const start = new Date(this.currentSession.startTime);
                this.elapsedSeconds = Math.floor((now - start) / 1000);
                
                const timerEl = document.querySelector('.timer-value');
                if (timerEl) {
                    if (this.sessionType === 'timer') {
                        const remaining = Math.max(0, this.timerMinutes * 60 - this.elapsedSeconds);
                        timerEl.textContent = this.formatTime(remaining);
                        
                        if (remaining === 0 && !this.alarmPlayed) {
                            this.alarmPlayed = true;
                            this.playAlarm();
                            setTimeout(() => this.endSession(), 2000);
                        }
                    } else {
                        timerEl.textContent = this.formatTime(this.elapsedSeconds);
                    }
                }
            },
            
            playAlarm() {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                oscillator.frequency.value = 800;
                oscillator.type = 'sine';
                gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 1);
            },
            
            addBook(title) {
                if (!title.trim()) return;
                const book = {
                    id: Date.now(),
                    title: title.trim(),
                    startDate: new Date().toISOString().split('T')[0],
                    completed: false
                };
                this.books.push(book);
                this.selectedBook = book.id;
                this.saveData();
                this.closeModal('addBookModal');
                this.render();
            },
            
            startSession(type) {
                if (!this.selectedBook) {
                    alert('Por favor selecciona un libro primero');
                    return;
                }
                this.currentSession = {
                    bookId: this.selectedBook,
                    startTime: new Date().toISOString(),
                    date: new Date().toISOString().split('T')[0]
                };
                this.sessionType = type;
                this.elapsedSeconds = 0;
                this.alarmPlayed = false;
                this.closeModal('sessionModal');
                this.render();
            },
            
            endSession() {
                if (!this.currentSession) return;
                const minutes = Math.round(this.elapsedSeconds / 60);
                this.sessions.push({
                    id: Date.now(),
                    bookId: this.currentSession.bookId,
                    date: this.currentSession.date,
                    startTime: this.currentSession.startTime,
                    endTime: new Date().toISOString(),
                    minutes: minutes
                });
                this.currentSession = null;
                this.sessionType = null;
                this.saveData();
                this.render();
            },
            
            completeBook(bookId, comment) {
                this.books = this.books.map(b => 
                    b.id === bookId 
                        ? { ...b, completed: true, completedDate: new Date().toISOString().split('T')[0], comment }
                        : b
                );
                this.saveData();
                this.closeModal('completeBookModal');
                this.render();
            },
            
            openModal(modalId) {
                document.getElementById(modalId).classList.add('active');
            },
            
            closeModal(modalId) {
                document.getElementById(modalId).classList.remove('active');
            },
            
            renderHome() {
                const consecutiveDays = this.getConsecutiveDays();
                const milestones = [3, 7, 14, 30, 60, 100, 365];
                const nextMilestone = milestones.find(m => m > consecutiveDays);
                const activeBooks = this.books.filter(b => !b.completed);
                const today = new Date().toISOString().split('T')[0];
                const todayMinutes = this.getTotalMinutes(today);
                const totalMinutes = this.getTotalMinutes();
                
                return `
                    <div class="card gradient-card">
                        <h2>Días Consecutivos</h2>
                        <div class="big-number">${consecutiveDays}</div>
                        ${nextMilestone ? `<div class="next-milestone">Siguiente hito: ${nextMilestone} días</div>` : ''}
                    </div>
                    
                    <div class="card">
                        <h2>Seleccionar Libro</h2>
                        ${activeBooks.map(book => `
                            <div class="book-item ${this.selectedBook === book.id ? 'selected' : ''}" 
                                 onclick="app.selectedBook = ${book.id}; app.render();">
                                <div class="book-title">${book.title}</div>
                                <div class="book-date">Iniciado: ${book.startDate}</div>
                            </div>
                        `).join('')}
                        <button class="btn btn-primary" onclick="app.openModal('addBookModal')">+ Agregar Nuevo Libro</button>
                    </div>
                    
                    ${this.currentSession ? `
                        <div class="card" style="background: #d1fae5; border: 2px solid #10b981;">
                            <h2>Sesión en curso</h2>
                            <p class="mb-3 text-gray">Leyendo: ${this.books.find(b => b.id === this.currentSession.bookId)?.title}</p>
                            <div class="session-timer">
                                <div class="timer-label">${this.sessionType === 'timer' ? 'Tiempo restante' : 'Tiempo transcurrido'}</div>
                                <div class="timer-value">${this.formatTime(0)}</div>
                            </div>
                            <button class="btn btn-danger" onclick="app.endSession()">Finalizar Sesión</button>
                        </div>
                    ` : `
                        <button class="btn btn-success" ${!this.selectedBook ? 'disabled' : ''} 
                                onclick="app.openModal('sessionModal')">Iniciar Sesión de Lectura</button>
                    `}
                    
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Hoy</div>
                            <div class="stat-value">${todayMinutes} min</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Total</div>
                            <div class="stat-value" style="color: #9333ea;">${totalMinutes} min</div>
                        </div>
                    </div>
                    
                    <div id="addBookModal" class="modal">
                        <div class="modal-content">
                            <h3>Agregar Libro</h3>
                            <input type="text" id="newBookTitle" placeholder="Título del libro" class="mb-4">
                            <div class="flex gap-2">
                                <button class="btn btn-primary" onclick="app.addBook(document.getElementById('newBookTitle').value)">Agregar</button>
                                <button class="btn btn-secondary" onclick="app.closeModal('addBookModal')">Cancelar</button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="sessionModal" class="modal">
                        <div class="modal-content">
                            <h3>Tipo de sesión</h3>
                            <div class="session-options">
                                <button class="option-btn" onclick="app.startSession('free')">
                                    <div class="option-title">Lectura Libre</div>
                                    <div class="option-desc">Con cronómetro</div>
                                </button>
                                <div class="option-btn">
                                    <div class="option-title">Temporizador</div>
                                    <div class="option-desc">Con alarma y finalización automática</div>
                                    <div class="timer-input-group">
                                        <input type="number" class="timer-input" min="1" max="180" value="${this.timerMinutes}" 
                                               onchange="app.timerMinutes = parseInt(this.value)">
                                        <span class="text-sm">minutos</span>
                                        <button class="btn btn-primary" style="width: auto; padding: 0.5rem 1rem;" 
                                                onclick="app.startSession('timer')">Iniciar</button>
                                    </div>
                                </div>
                            </div>
                            <button class="btn btn-secondary" onclick="app.closeModal('sessionModal')">Cancelar</button>
                        </div>
                    </div>
                `;
            },
            
            renderStats() {              
    const now = new Date();
    const year = now.getFullYear();
    const month = now.getMonth();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    
    const dailyData = [];
    for (let day = 1; day <= daysInMonth; day++) {
        const date = new Date(year, month, day).toISOString().split('T')[0];
        dailyData.push({ day, minutes: this.getTotalMinutes(date) });
    }
    
    const maxDaily = Math.max(...dailyData.map(d => d.minutes), 1);
    const yAxisMax = Math.ceil(maxDaily / 10) * 10 || 10;
    
    const monthNames = ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'];
    const monthlyData = monthNames.map((name, i) => ({
        month: name,
        minutes: this.sessions.filter(s => new Date(s.date).getFullYear() === year && new Date(s.date).getMonth() === i)
            .reduce((sum, s) => sum + s.minutes, 0)
    }));
    const maxMonthly = Math.max(...monthlyData.map(d => d.minutes), 1);
    
    return `
        <div class="card">
            <h2>Minutos por Día (Este Mes)</h2>
            <div style="display: flex; gap: 0.5rem;">
                <div style="display: flex; flex-direction: column-reverse; justify-content: space-between; font-size: 0.75rem; color: #6b7280; height: 10rem; padding: 0.5rem 0;">
                    <span>0</span>
                    ${Array.from({length: yAxisMax/10}, (_, i) => `<span>${(i+1)*10}</span>`).join('')}
                </div>
                <div style="flex: 1; display: flex; align-items: flex-end; height: 10rem; border-left: 1px solid #d1d5db; border-bottom: 1px solid #d1d5db; gap: 1px;">
                    ${dailyData.map(d => {
                        const heightPx = yAxisMax > 0 ? Math.floor((d.minutes / yAxisMax) * 160) : 0;
                        return `
                        <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
                            <div class="bar" style="height: ${d.minutes > 0 ? heightPx + 'px' : '0'}; min-height: ${d.minutes > 0 ? '3px' : '0'};" 
                                 title="Día ${d.day}: ${d.minutes} min"></div>
                            <div class="day-label">${d.day}</div>
                        </div>
                    `}).join('')}
                </div>
            </div>
        </div>
        
        <div class="card">
            <h2>Minutos por Mes (Este Año)</h2>
            ${monthlyData.map(d => `
                <div class="month-bar">
                    <div class="month-label">${d.month}</div>
                    <div class="month-bar-bg">
                        ${d.minutes > 0 ? `
                            <div class="month-bar-fill" style="width: ${(d.minutes / maxMonthly) * 100}%;">
                                <span class="month-bar-text">${d.minutes}min</span>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('')}
        </div>
    `;
},
            
            renderBooks() {
                const activeBooks = this.books.filter(b => !b.completed);
                const completedBooks = this.books.filter(b => b.completed);
                
                return `
                    <div class="card">
                        <h3 style="color: #10b981;">En progreso</h3>
                        ${activeBooks.map(book => `
                            <div class="book-item">
                                <div class="book-title">${book.title}</div>
                                <div class="book-date mb-2">Iniciado: ${book.startDate}</div>
                                <button class="btn btn-success" style="padding: 0.5rem 1rem; width: auto;" 
                                        onclick="app.openModal('completeBookModal'); app.completingBookId = ${book.id};">
                                    Marcar como terminado
                                </button>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="card">
                        <h3 style="color: #3b82f6;">Completados</h3>
                        ${completedBooks.map(book => `
                            <div class="book-item" style="background: #eff6ff;">
                                <div class="book-title">${book.title} ✓</div>
                                <div class="book-date">${book.startDate} - ${book.completedDate}</div>
                                ${book.comment ? `<p class="text-sm mt-2" style="font-style: italic;">"${book.comment}"</p>` : ''}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div id="completeBookModal" class="modal">
                        <div class="modal-content">
                            <h3>Comentario del libro</h3>
                            <textarea id="bookComment" placeholder="¿Qué te pareció este libro? (opcional)" class="mb-4"></textarea>
                            <div class="flex gap-2">
                                <button class="btn btn-success" onclick="app.completeBook(app.completingBookId, document.getElementById('bookComment').value)">Guardar</button>
                                <button class="btn btn-secondary" onclick="app.closeModal('completeBookModal')">Cancelar</button>
                            </div>
                        </div>
                    </div>
                `;
            }
        };
        
        app.init();
    </script>
</body>
</html>




